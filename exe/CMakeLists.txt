# We compile our own custom Lua
SET(Lua_IS_SUBPROJECT ON)
SET(Lua_INSTALL_BIN_SUBDIR "${Torch_INSTALL_BIN_SUBDIR}")
SET(Lua_INSTALL_LIB_SUBDIR "${Torch_INSTALL_LIB_SUBDIR}")
SET(Lua_INSTALL_INCLUDE_SUBDIR "${Torch_INSTALL_INCLUDE_SUBDIR}")
SET(Lua_INSTALL_LUA_PATH_SUBDIR "${Torch_INSTALL_LUA_PATH_SUBDIR}")
SET(Lua_INSTALL_LUA_CPATH_SUBDIR "${Torch_INSTALL_LUA_CPATH_SUBDIR}")
SET(Lua_INSTALL_BIN_RIDBUS "${Torch_INSTALL_BIN_RIDBUS}")
SET(Lua_INSTALL_FINDLUA_DIR "${Torch_BINARY_DIR}/cmake")

SET(WITH_LUA_JIT ON CACHE BOOL "Use LuaJIT instead of Lua")
IF(WITH_LUA_JIT)
  ADD_SUBDIRECTORY(luajit)
  SET(LUA_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/luajit/src" "${CMAKE_CURRENT_BINARY_DIR}/luajit")
  SET(LUA_LIBRARIES "liblua-shared")
ELSE(WITH_LUA_JIT)
  ADD_SUBDIRECTORY(lua)
  SET(LUA_INCLUDE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/lua/src" "${CMAKE_CURRENT_BINARY_DIR}/lua")
  SET(LUA_LIBRARIES "liblua-shared")
ENDIF(WITH_LUA_JIT)

SET_TARGET_PROPERTIES(lua PROPERTIES OUTPUT_NAME "torch-lua")
GET_TARGET_PROPERTY(luac OUTPUT_NAME LUAC_EXISTS)
IF(LUAC_EXISTS)
  SET_TARGET_PROPERTIES(luac PROPERTIES OUTPUT_NAME "torch-luac")
ENDIF(LUAC_EXISTS)
SET_TARGET_PROPERTIES(liblua-shared PROPERTIES OUTPUT_NAME "torch-lua")

# We compile our own custom QtLua
SET(QtLua_IS_SUBPROJECT ON)
SET(QtLua_INSTALL_PREFIX "${Torch_INSTALL_PREFIX}")
SET(QtLua_INSTALL_BIN_SUBDIR "${Torch_INSTALL_BIN_SUBDIR}")
SET(QtLua_INSTALL_LIB_SUBDIR "${Torch_INSTALL_LIB_SUBDIR}")
SET(QtLua_INSTALL_INCLUDE_SUBDIR "${Torch_INSTALL_INCLUDE_SUBDIR}")
SET(QtLua_INSTALL_LUA_PATH_SUBDIR "${Torch_INSTALL_LUA_PATH_SUBDIR}")
SET(QtLua_INSTALL_LUA_CPATH_SUBDIR "${Torch_INSTALL_LUA_CPATH_SUBDIR}")
SET(QtLua_INSTALL_CMAKE_SUBDIR "${Torch_INSTALL_CMAKE_SUBDIR}")
SET(QtLua_INSTALL_BIN_RIDBUS "${Torch_INSTALL_BIN_RIDBUS}")
SET(QtLua_INSTALL_FINDLUA_DIR "${Torch_BINARY_DIR}/cmake")

ADD_SUBDIRECTORY(qtlua)
IF(WITH_QTLUA)
  SET_TARGET_PROPERTIES(qlua PROPERTIES OUTPUT_NAME "torch-qlua")
  GET_TARGET_PROPERTY(macqlua OUTPUT_NAME MACQLUA_EXISTS)
  IF(MACQLUA_EXISTS)
    SET_TARGET_PROPERTIES(macqlua PROPERTIES OUTPUT_NAME "torch-macqlua")
  ENDIF(MACQLUA_EXISTS)
ENDIF(WITH_QTLUA)

SET(WITH_ROCKS ON CACHE BOOL "Use rocks instead of torch-pkg")

IF(WITH_ROCKS)
  ADD_SUBDIRECTORY(luarocks)
ELSE()
  # Our package manager
  ADD_SUBDIRECTORY(torch-pkg)
ENDIF()

# Our torch executable
ADD_SUBDIRECTORY(torch-exe)
